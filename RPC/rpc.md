# 哈希一致性算法

## 背景

在分布式的架构下请求或者缓存对服务器的映射，如果只用简单的取模运算，会出现伸缩性的问题。如果想要添加新的服务器资源，或者某些服务器变得不可用，都会造成重新哈希，由于总数改变了，所以缓存会失效造成缓存雪崩。

而哈希一致性算法解决了分布式系统的分区问题。该算法是对固定值取模，这样就用很好的单调性，集群中的节点只要 key 固定，位置就固定。一般对 2^32 取模：

1. 将空间映射成一个环，哈希空间的取值范围是 0 ~ 2^32 - 1
2. 计算服务器节点的哈希值，映射到环上
3. 将请求使用哈希算法算出对应的哈希值，顺时针方向寻找到第一台服务器。
4. 增加或删除节点的时候，受影响的数据只是这台服务器逆时针方向上到前一个节点之间的数据。
5. 为了防止很多数据都哈希映射到相同的节点，失去负载均衡的效果，可以为每个节点设置多个虚拟节点。

#
